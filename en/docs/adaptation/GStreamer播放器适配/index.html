<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-adaptation/GStreamer播放器适配" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">GStreamer Player Porting | RevyOS Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kagrua114.github.io/revyos-docs-new/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kagrua114.github.io/revyos-docs-new/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kagrua114.github.io/revyos-docs-new/en/docs/adaptation/GStreamer播放器适配"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="GStreamer Player Porting | RevyOS Docs"><meta data-rh="true" name="description" content="Applicable SDK v1.1.2"><meta data-rh="true" property="og:description" content="Applicable SDK v1.1.2"><link data-rh="true" rel="icon" href="/revyos-docs-new/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kagrua114.github.io/revyos-docs-new/en/docs/adaptation/GStreamer播放器适配"><link data-rh="true" rel="alternate" href="https://kagrua114.github.io/revyos-docs-new/docs/adaptation/GStreamer播放器适配" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://kagrua114.github.io/revyos-docs-new/en/docs/adaptation/GStreamer播放器适配" hreflang="en"><link data-rh="true" rel="alternate" href="https://kagrua114.github.io/revyos-docs-new/docs/adaptation/GStreamer播放器适配" hreflang="x-default"><link rel="stylesheet" href="/revyos-docs-new/en/assets/css/styles.57d8f497.css">
<script src="/revyos-docs-new/en/assets/js/runtime~main.74a3ab59.js" defer="defer"></script>
<script src="/revyos-docs-new/en/assets/js/main.fb8c392a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/revyos-docs-new/en/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/revyos-docs-new/en/"><div class="navbar__logo"><img src="/revyos-docs-new/en/img/logo.svg" alt="RevyOS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/revyos-docs-new/en/img/logo.svg" alt="RevyOS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">RevyOS Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/revyos-docs-new/en/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/revyos-docs-new/en/docs/issue">Issues</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/revyos/revyos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/revyos-docs-new/docs/adaptation/GStreamer播放器适配" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li><li><a href="/revyos-docs-new/en/docs/adaptation/GStreamer播放器适配" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/revyos-docs-new/en/docs/intro">RevyOS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/revyos-docs-new/en/docs/build/debian/Debian软件包构建流程">Build</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/revyos-docs-new/en/docs/adaptation/GStreamer播放器适配">Porting Docs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/revyos-docs-new/en/docs/adaptation/GStreamer播放器适配">GStreamer Player Porting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/revyos-docs-new/en/docs/adaptation/GStreamer-pipeline-example-with-thead-omxil-lib">GStreamer Pipeline Example</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/revyos-docs-new/en/docs/desktop/revyos-use-docker">System Usage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/revyos-docs-new/en/docs/benchmark/Chromium-Fish-Bowl-Test">Benchmark</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/revyos-docs-new/en/docs/Installation/intro">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/revyos-docs-new/en/docs/Changelog/changelog-index">Changelog</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/revyos-docs-new/en/docs/issue">Submitting Issues and Known Issues</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/revyos-docs-new/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Porting Docs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">GStreamer Player Porting</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Adaptation Documentation for GStreamer Player Supporting PTG omxil Library</h1></header>
<p>Applicable SDK v1.1.2</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>PTG&#x27;s OpenMAX IL library (<code>vpu-omxil</code>) enables the LicheePi 4A to smoothly perform hardware decoding for 4K 60fps video playback. This document details the integration and usage of the Parole player on the LicheePi 4A development board, providing a guide to the adaptation process on this platform. The workflow for hardware decoding, using H.264 as an example, is shown below.</p>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">                +-------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                |    +------------+       +------------+    |   +--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">video stream----+---&gt;| omxh264dec +------&gt;| video-sink +----+--&gt;| player |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                |    +------+-----+       +------------+    |   +--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                |           |     GStreamer                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                +-----------+-------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      +-----v-----+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      | vpu-omxil |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      +-----+-----+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    +-------v-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    | kernel module |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    |    (driver)   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    +-------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        hardware</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>The video stream is read into GStreamer, processed, and sent to the <code>omxh264dec</code> decoder in GStreamer.</li>
<li><code>omxh264dec</code> invokes PTG&#x27;s <code>vpu-omxil</code> library, which accesses the hardware through the driver (kernel module) for hardware decoding.</li>
<li>The decoded stream is then passed to GStreamer&#x27;s video sink and rendered by the player.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-gstreamer-omxh264dec-decoding-test">A. GStreamer omxh264dec Decoding Test<a href="#a-gstreamer-omxh264dec-decoding-test" class="hash-link" aria-label="Direct link to A. GStreamer omxh264dec Decoding Test" title="Direct link to A. GStreamer omxh264dec Decoding Test">​</a></h2>
<p>To isolate the <code>omxh264dec</code> decoding component, the general structure is as follows:</p>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +---+------------+----+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   +------------+    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   | omxh264dec |    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   +------------+    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |      GStreamer      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +----------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +----+-----v-----+----+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |    +-----------+    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |    | vpu-omxil |    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |    +-----------+    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  libomxil-bellagio  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +----------+----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------v------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  - memalloc   - vc8000  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  - hantrodec  - vidmem  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      kernel modules     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hardware</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This section focuses on enabling the <code>omxh264dec</code> decoder, without involving screen output.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-driver-compilation-installation-and-hardware-access-permissions">1. Driver Compilation, Installation, and Hardware Access Permissions<a href="#1-driver-compilation-installation-and-hardware-access-permissions" class="hash-link" aria-label="Direct link to 1. Driver Compilation, Installation, and Hardware Access Permissions" title="Direct link to 1. Driver Compilation, Installation, and Hardware Access Permissions">​</a></h3>
<p>To enable hardware decoding, drivers must be compiled and installed to access the hardware.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="11-compile-drivers">1.1 Compile Drivers<a href="#11-compile-drivers" class="hash-link" aria-label="Direct link to 1.1 Compile Drivers" title="Direct link to 1.1 Compile Drivers">​</a></h4>
<p>PTG-provided driver sources:</p>
<ul>
<li><a href="https://github.com/revyos/vpu-vc8000e-kernel" target="_blank" rel="noopener noreferrer">vpu-vc8000e-kernel</a></li>
<li><a href="https://github.com/revyos/vpu-vc8000d-kernel" target="_blank" rel="noopener noreferrer">vpu-vc8000d-kernel</a></li>
<li><a href="https://github.com/revyos/video_memory" target="_blank" rel="noopener noreferrer">video_memory</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="111-alternative-solution">1.1.1 Alternative Solution<a href="#111-alternative-solution" class="hash-link" aria-label="Direct link to 1.1.1 Alternative Solution" title="Direct link to 1.1.1 Alternative Solution">​</a></h5>
<p>The <a href="https://github.com/revyos/thead-kernel" target="_blank" rel="noopener noreferrer">revyos/thead-kernel</a> has merged the above modules, so you may avoid compiling these if using <code>revyos_defconfig</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="12-install-drivers">1.2 Install Drivers<a href="#12-install-drivers" class="hash-link" aria-label="Direct link to 1.2 Install Drivers" title="Direct link to 1.2 Install Drivers">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Use depmod to analyze dependencies and create modules.dep in /lib/modules/&lt;kernel-version&gt;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo depmod -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe vidmem vc8000 hantrodec memalloc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># If modprobe fails, try using insmod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cd /usr/lib/modules/$(uname -r)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sudo insmod $(find . -name *vidmem.ko*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sudo insmod $(find . -name *vc8000.ko*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sudo insmod $(find . -name *hantrodec.ko*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sudo insmod $(find . -name *memalloc.ko*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Optional: Load modules at boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -e &quot;\nvidmem\nhantrodec\nmemalloc\nvc8000\n&quot; | sudo tee -a /etc/modules &gt; /dev/null</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="13-set-hardware-access-permissions">1.3 Set Hardware Access Permissions<a href="#13-set-hardware-access-permissions" class="hash-link" aria-label="Direct link to 1.3 Set Hardware Access Permissions" title="Direct link to 1.3 Set Hardware Access Permissions">​</a></h4>
<p>After installing kernel modules, device files for <code>hantrodec</code>, <code>vidmem</code>, and <code>vc8000</code> will appear in <code>/dev</code>. By default, users lack access permissions, so non-root users will encounter errors when opening the omxil library.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># For one-time effect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chmod 666 hantrodec vidmem vc8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># For persistent effect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt; EOF | sudo tee /lib/udev/rules.d/70-hantro.rules &gt; /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KERNEL==&quot;vidmem&quot;, MODE=&quot;0666&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KERNEL==&quot;hantrodec&quot;, MODE=&quot;0666&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KERNEL==&quot;vc8000&quot;, MODE=&quot;0666&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="revyos-adaptation-record">RevyOS Adaptation Record<a href="#revyos-adaptation-record" class="hash-link" aria-label="Direct link to RevyOS Adaptation Record" title="Direct link to RevyOS Adaptation Record">​</a></h4>
<p>For RevyOS-specific kernel modules, go to <a href="https://github.com/revyos/thead-kernel" target="_blank" rel="noopener noreferrer">revyos/thead-kernel</a> and download artifacts from GitHub CI.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-install-vpu-omxil-and-adjust-configuration">2. Install <code>vpu-omxil</code> and Adjust Configuration<a href="#2-install-vpu-omxil-and-adjust-configuration" class="hash-link" aria-label="Direct link to 2-install-vpu-omxil-and-adjust-configuration" title="Direct link to 2-install-vpu-omxil-and-adjust-configuration">​</a></h3>
<p>First, download and extract <code>vpu-omxil</code> to <code>/usr/lib/omxil/</code>.
<a href="https://drive.google.com/file/d/1pYgCVI7WltfpskltJ-RqzVUCEC21FS56" target="_blank" rel="noopener noreferrer">Download vpu-omxil_1.2.1.tar.gz</a></p>
<p>As illustrated below, the following steps are required:</p>
<ol>
<li>Register the OpenMax components in <code>vpu-omxil</code> with <code>libomxil-bellagio</code>.</li>
<li>Configure <code>gst-omx</code> (which provides the <code>omxh264dec</code> decoder) to recognize the component names when calling <code>libomxil-bellagio</code>.</li>
</ol>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+---------+   +-------------------+   +-----------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| gst-omx +--&gt;| libomxil-bellagio +--&gt;| vpu-omxil |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------+   +-------------------+   +-----------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="21-register-components-in-vpu-omxil-with-libomxil-bellagio">2.1 Register Components in <code>vpu-omxil</code> with <code>libomxil-bellagio</code><a href="#21-register-components-in-vpu-omxil-with-libomxil-bellagio" class="hash-link" aria-label="Direct link to 21-register-components-in-vpu-omxil-with-libomxil-bellagio" title="Direct link to 21-register-components-in-vpu-omxil-with-libomxil-bellagio">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install libomxil-bellagio-bin libomxil-bellagio0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Register components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">omxregister-bellagio -v /usr/lib/omxil/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The registration file is generated by <code>omxregister-bellagio</code> and, by default, is located at <code>~/.omxregister</code>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="211-revyosdebian-component-registration">2.1.1 RevyOS/Debian Component Registration<a href="#211-revyosdebian-component-registration" class="hash-link" aria-label="Direct link to 2.1.1 RevyOS/Debian Component Registration" title="Direct link to 2.1.1 RevyOS/Debian Component Registration">​</a></h5>
<p><a href="https://github.com/revyos/th1520-vpu" target="_blank" rel="noopener noreferrer">th1520-vpu</a> utilizes Debian’s automatic registration process in <code>/usr/lib/riscv64-linux-gnu/libomxil-bellagio0</code> upon installation. The resulting registry appears as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /var/lib/libomxil-bellagio0/registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/riscv64-linux-gnu/libomxil-bellagio0/libOMX.hantro.H2.video.encoder.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ==&gt; OMX.hantro.H2.video.encoder ==&gt; OMX.hantro.H2.video.encoder.avc:OMX.hantro.H2.video.encoder.hevc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/riscv64-linux-gnu/libomxil-bellagio0/libOMX.hantro.VC8000D.image.decoder.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ==&gt; OMX.hantro.VC8000D.image.decoder ==&gt; OMX.hantro.VC8000D.image.decoder.jpeg:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/riscv64-linux-gnu/libomxil-bellagio0/libOMX.hantro.H2.image.encoder.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ==&gt; OMX.hantro.H2.image.encoder ==&gt; OMX.hantro.H2.image.encoder.jpeg:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/riscv64-linux-gnu/libomxil-bellagio0/libOMX.hantro.VC8000D.video.decoder.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ==&gt; OMX.hantro.VC8000D.video.decoder ==&gt; OMX.hantro.VC8000D.video.decoder.mpeg4:OMX.hantro.VC8000D.video.decoder.avc:OMX.hantro.VC8000D.video.decoder.avs:OMX.hantro.VC8000D.video.decoder.h263:OMX.hantro.VC8000D.video.decoder.wmv:OMX.hantro.VC8000D.video.decoder.vp6:OMX.hantro.VC8000D.video.decoder.vp8:OMX.hantro.VC8000D.video.decoder.jpeg:OMX.hantro.VC8000D.video.decoder.hevc:OMX.hantro.VC8000D.video.decoder.vp9:OMX.hantro.VC8000D.video.decoder.avs2:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-configure-gstomxconf">2.2 Configure <code>gstomx.conf</code><a href="#22-configure-gstomxconf" class="hash-link" aria-label="Direct link to 22-configure-gstomxconf" title="Direct link to 22-configure-gstomxconf">​</a></h4>
<p>Adjust the <code>gstomx.conf</code> settings to ensure the <code>omxh264dec</code> decoder calls the correct components. See the following patch for <code>gst-omx</code> configuration details:</p>
<p><a href="https://gist.github.com/Sakura286/26777ea8204c1819885e093806a4f7ca#file-gst-omx-01-add-libomxil-config-patch" target="_blank" rel="noopener noreferrer">gst-omx-01-add-libomxil-config.patch</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-add-dmabuf-patch">3. Add <code>dmabuf</code> Patch<a href="#3-add-dmabuf-patch" class="hash-link" aria-label="Direct link to 3-add-dmabuf-patch" title="Direct link to 3-add-dmabuf-patch">​</a></h3>
<p>Please refer to the <code>dmabuf</code> patch for <code>gst-omx</code> provided by PTG:</p>
<p><a href="https://gist.github.com/Sakura286/26777ea8204c1819885e093806a4f7ca#file-gst-omx-02-set-dec-out-port-dmabuf-patch" target="_blank" rel="noopener noreferrer">gst-omx-02-set-dec-out-port-dmabuf.patch</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-initial-gstreamer-decoding-test">4. Initial GStreamer Decoding Test<a href="#4-initial-gstreamer-decoding-test" class="hash-link" aria-label="Direct link to 4. Initial GStreamer Decoding Test" title="Direct link to 4. Initial GStreamer Decoding Test">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install gstreamer1.0-omx-generic gstreamer1.0-omx-bellagio-config gstreamer1.0-plugins-bad gstreamer1.0-plugins-base gstreamer1.0-gl gstreamer1.0-plugins-good gstreamer1.0-tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1. Basic decoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gst-launch-1.0 filesrc location=&lt;test.mp4&gt; ! qtdemux !  h264parse ! omxh264dec  ! videoconvert ! fakesink  sync=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. Display FPS in the terminal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Reference: https://stackoverflow.com/questions/73948308</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gst-launch-1.0 filesrc location=&lt;test.mp4&gt; ! qtdemux !  h264parse ! omxh264dec  ! videoconvert ! fpsdisplaysink video-sink=fakesink  text-overlay=false sync=false -v 2&gt;&amp;1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>fakesink</code> discards all incoming video frames, bypassing the <code>video-sink</code> rendering stage to avoid performance loss, while <code>fpsdisplaysink</code> provides decoding speed statistics. Sample log output:</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Setting pipeline to PAUSED ...[DBGT]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vc8kdec compiled without trace support (ENABLE_DBGT_TRACE switch not enabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pipeline is PREROLLING ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Redistribute latency...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OMX  ! decoder_get_parameter OMX_ErrorNoMore (2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pipeline is PREROLLED ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setting pipeline to PLAYING ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New clock: GstSystemClockRedistribute latency...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0:01:39.5 / 0:01:49.4 (90.9 %)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Tip:</strong> If encountering errors such as <code>[omxh264dec-omxh264dec0: Could not initialize supporting library.](https://gist.github.com/Sakura286/015fae6792e160268db7ad8a697dd2df)</code>, consider installing the debug-symbol packages for <code>gst-omx</code>, <code>libomxil-bellagio</code>, and <code>libc6</code>. Use <code>gdb</code> to troubleshoot by running the command above, setting a breakpoint at <code>DWLInit</code> and <code>open</code> to pinpoint where the issue arises.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="revyos-compatibility-notes">RevyOS Compatibility Notes<a href="#revyos-compatibility-notes" class="hash-link" aria-label="Direct link to RevyOS Compatibility Notes" title="Direct link to RevyOS Compatibility Notes">​</a></h4>
<p>During the RevyOS adaptation process, the following issues were identified as causes for dynamic library initialization failures:</p>
<ol>
<li>Incompatible toolchain used when compiling <code>vpu-omxil</code>.</li>
<li>Missing <code>vpu-omxil</code> registration with <code>omxregister-bellagio</code>.</li>
<li>Insufficient permissions for <code>/dev</code> devices <code>hantrodec</code>, <code>vc8000</code>, and <code>vidmem</code>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="b-choosing-the-right-gstreamer-video-sink">B. Choosing the Right GStreamer <code>video-sink</code><a href="#b-choosing-the-right-gstreamer-video-sink" class="hash-link" aria-label="Direct link to b-choosing-the-right-gstreamer-video-sink" title="Direct link to b-choosing-the-right-gstreamer-video-sink">​</a></h2>
<p>The <code>video-sink</code> is the last step in the <a href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/concepts.html" target="_blank" rel="noopener noreferrer">GStreamer pipeline</a>, handling the final output of the video stream to the screen.
In the tests above, <code>fakesink</code> served as a testing <code>video-sink</code> to verify decoder functionality. There are, however, many <code>video-sink</code> options available (<a href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/platform-specific-elements.html?gi-language=c" target="_blank" rel="noopener noreferrer">see list</a>), such as <code>autovideosink</code>, <code>ximagesink</code>, <code>xvimagesink</code>, <code>fbdevsink</code>, <code>waylandsink</code>, <code>glimagesink</code>, <code>gtkglsink</code>, each requiring specific installation packages as follows:</p>
<table><thead><tr><th><strong>video-sink</strong></th><th><strong>Package</strong></th></tr></thead><tbody><tr><td>waylandsink</td><td>gstreamer1.0-plugins-bad</td></tr><tr><td>fbdevsink</td><td>gstreamer1.0-plugins-bad</td></tr><tr><td>autovideosink</td><td>gstreamer1.0-plugins-good</td></tr><tr><td>gtkglsink</td><td>gstreamer1.0-plugins-good</td></tr><tr><td>ximagesink | xvimagesink</td><td>gstreamer1.0-plugins-base</td></tr><tr><td>glimagesink</td><td>gstreamer1.0-plugins-base | gstreamer1.0-gl</td></tr></tbody></table>
<p><strong>Tip:</strong> Use <code>gst-inspect-1.0 &lt;video-sink-name&gt;</code> to view available options for each <code>video-sink</code>.
<strong>Tip:</strong> Adjust <code>--gst-debug-level=&lt;lv&gt;</code> to set the <a href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/debugging-tools.html#the-debug-log" target="_blank" rel="noopener noreferrer">debug log level</a>, where <code>&lt;lv&gt;</code> ranges from 1 to 6, with higher levels providing more verbose output. Setting the level below 4 is recommended, as higher levels can result in very long logs.
Experiment with different <code>video-sink</code> options, plugin parameters, and environmental variables until you find one that enables smooth H.264 hardware decoding.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="revyos-adaptation-notes">RevyOS Adaptation Notes<a href="#revyos-adaptation-notes" class="hash-link" aria-label="Direct link to RevyOS Adaptation Notes" title="Direct link to RevyOS Adaptation Notes">​</a></h3>
<ul>
<li><strong>waylandsink</strong>: As RevyOS is currently (20230720) using the Xfce desktop environment, Wayland support is not feasible, so <code>waylandsink</code> is inherently unusable.</li>
<li><strong>fbdevsink</strong> and <strong>ximagesink</strong>: Both are unusable.</li>
<li><strong>xvimagesink</strong>: From <a href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/debugging-tools.html#getting-pipeline-graphs" target="_blank" rel="noopener noreferrer">pipeline graphs</a> and logs, we can see that <code>playbin</code> or <code>autovideosink</code> automatically calls <code>xvimagesink</code>. After analyzing with <code>perf</code>, it’s evident that <code>xvimagesink</code> involves significant <code>memcpy</code> operations, severely impacting decoding performance. This issue persists even with the PTG-provided <code>dmabuf</code> patch, so it’s not a viable option.</li>
<li><strong>gtkglsink</strong>: Due to <a href="https://gitlab.gnome.org/GNOME/gtk/-/issues/738" target="_blank" rel="noopener noreferrer">GTK3’s lack of support for EGL on X11</a>, and as RevyOS is based on X11 and only supports EGL, this option is also unusable.</li>
</ul>
<p>The only remaining option is <code>glimagesink</code>. Based on <a href="https://gstreamer.freedesktop.org/documentation/gstreamer/running.html#environment-variables" target="_blank" rel="noopener noreferrer">Running and debugging GStreamer Applications</a> and examples that use <code>glimagesink</code>, it appears necessary to specify the environment variables <code>GST_GL_API</code> and <code>GST_GL_PLATFORM</code>. Since RevyOS uses a <code>gles2</code> + <code>egl</code> setup, the following command enables successful hardware decoding:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GST_GL_API=gles2 GST_GL_PLATFORM=egl gst-launch-1.0 filesrc location=&lt;test.mp4&gt; ! qtdemux !  h264parse ! omxh264dec  ! videoconvert ! fpsdisplaysink video-sink=glimagesink sync=false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, these parameters cannot be passed as environment variables when GStreamer is invoked by a media player. Therefore, it’s essential to pass additional <code>meson</code> build options when compiling <code>gst-plugins-base</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-Dgl_api=[\&#x27;gles2\&#x27;] -Dgl_platform=[\&#x27;egl\&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="c-player-support">C. Player Support<a href="#c-player-support" class="hash-link" aria-label="Direct link to C. Player Support" title="Direct link to C. Player Support">​</a></h2>
<p>Once the GStreamer pipeline functions correctly, the next step is to enable player support. Different players utilize different <code>video-sink</code> elements and have varying levels of dependency on GStreamer. The adaptation strategy for players is to either (1) modify the player to support the verified <code>video-sink</code> or (2) modify the GStreamer pipeline to support the player’s specified <code>video-sink</code>. The RevyOS adaptation process adopts the first approach.</p>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">                +-------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                |    +------------+       +------------+    |   +--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">video stream----+---&gt;| omxh264dec +------&gt;| video-sink +----+--&gt;| player |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                |    +------------+       +------------+    |   +--------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                |                GStreamer                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                +-------------------------------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="revyos-adaptation-notes-1">RevyOS Adaptation Notes<a href="#revyos-adaptation-notes-1" class="hash-link" aria-label="Direct link to RevyOS Adaptation Notes" title="Direct link to RevyOS Adaptation Notes">​</a></h3>
<p>Based on the <a href="https://gstreamer.freedesktop.org/apps/" target="_blank" rel="noopener noreferrer">GStreamer-supported applications list</a>:</p>
<table><thead><tr><th>Usable</th><th>Updated</th><th>Application</th><th>Notes</th></tr></thead><tbody><tr><td>❌</td><td></td><td>Gnash</td><td>Flash Player</td></tr><tr><td>❌</td><td></td><td>GEntrans</td><td>Not in Debian</td></tr><tr><td>❓</td><td>20230226</td><td>Kaffeine</td><td>❌ Requires extensive KDE dependencies</td></tr><tr><td></td><td></td><td></td><td>✔️ Present in the <a href="https://buildd.debian.org/status/package.php?p=kaffeine&amp;suite=sid" target="_blank" rel="noopener noreferrer">riscv64 repository</a></td></tr><tr><td></td><td></td><td></td><td>❌ On Debian amd64 Gnome, the playback and control windows are separated, with VLC as the default player.</td></tr><tr><td>❌</td><td></td><td>Lcdgrilo</td><td>Not in Debian</td></tr><tr><td>✔️</td><td>20230218</td><td>Parole</td><td>✔️ For XFCE</td></tr><tr><td></td><td></td><td></td><td>❓ No Wayland support, X11 only</td></tr><tr><td></td><td></td><td></td><td>✔️ Verified on Debian amd64 Gnome</td></tr><tr><td></td><td></td><td></td><td>✔️ Available in the <a href="https://buildd.debian.org/status/package.php?p=parole&amp;suite=sid" target="_blank" rel="noopener noreferrer">riscv64 repository</a></td></tr><tr><td>❌</td><td></td><td>Songbird</td><td>Not in Debian</td></tr><tr><td>❌</td><td></td><td>Snappy</td><td>Not in Debian</td></tr><tr><td>❌</td><td></td><td>Totem</td><td>Requires GTK3, which doesn’t support EGL on X11</td></tr></tbody></table>
<p>Totem was initially chosen but proved difficult to support due to its inability to specify a <code>video-sink</code> other than <code>gtkglsink</code>, which RevyOS does not support. After evaluating GStreamer-compatible players, Parole emerged as a suitable choice. Parole, written with GObject, requires modification in the <code>parole_gst_constructed</code> method to set <code>video-sink</code> to <code>glimagesink</code>, as previously validated. The patch can be found here:</p>
<p><a href="https://gist.github.com/Sakura286/26777ea8204c1819885e093806a4f7ca#file-parole-01-add-glimagesink-support-patch" target="_blank" rel="noopener noreferrer">parole-01-add-glimagesink-support.patch</a></p>
<p>With this, the preliminary adaptation work is complete.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary-of-revyos-adaptation-work">Summary of RevyOS Adaptation Work<a href="#summary-of-revyos-adaptation-work" class="hash-link" aria-label="Direct link to Summary of RevyOS Adaptation Work" title="Direct link to Summary of RevyOS Adaptation Work">​</a></h2>
<ol>
<li>Compile driver modules into the kernel, enable them at boot, and set device permissions.</li>
<li>Package PTG&#x27;s <code>omxil</code> binary dynamic library files as <code>th1520-vpu</code>.<!-- -->
<ol>
<li>Modify <code>th1520-vpu</code> dependencies to require <code>gst-omx</code>, <code>libomxil-bellagio</code>, etc.</li>
<li>Add post-install operations, such as registering components with <code>omxregister-bellagio</code>.</li>
</ol>
</li>
<li>Modify <code>gst-omx</code>:<!-- -->
<ol>
<li>Add support for the <code>vpu-omxil</code> component in the config.</li>
<li>Apply <code>dmabuf</code> patches.</li>
<li>Add support for h265 and vp9.</li>
</ol>
</li>
<li>Modify <code>gst-base</code> to limit GL support to <code>gles2</code> + <code>egl</code> during compilation.</li>
<li>Modify Parole to support <code>glimagesink</code>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources-used">Resources Used<a href="#resources-used" class="hash-link" aria-label="Direct link to Resources Used" title="Direct link to Resources Used">​</a></h2>
<p>Patch collection:</p>
<p><a href="https://gist.github.com/Sakura286/26777ea8204c1819885e093806a4f7ca" target="_blank" rel="noopener noreferrer">https://gist.github.com/Sakura286/26777ea8204c1819885e093806a4f7ca</a></p>
<p>PTG omxil library:</p>
<p><a href="https://drive.google.com/file/d/1pYgCVI7WltfpskltJ-RqzVUCEC21FS56" target="_blank" rel="noopener noreferrer">https://drive.google.com/file/d/1pYgCVI7WltfpskltJ-RqzVUCEC21FS56</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/kagura114/revyos-docs-new/docs/adaptation/GStreamer播放器适配.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/revyos-docs-new/en/docs/build/other/thead-qemu编译流程"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">T-Head QEMU Compilation Process</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/revyos-docs-new/en/docs/adaptation/GStreamer-pipeline-example-with-thead-omxil-lib"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GStreamer Pipeline Example</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#a-gstreamer-omxh264dec-decoding-test" class="table-of-contents__link toc-highlight">A. GStreamer omxh264dec Decoding Test</a><ul><li><a href="#1-driver-compilation-installation-and-hardware-access-permissions" class="table-of-contents__link toc-highlight">1. Driver Compilation, Installation, and Hardware Access Permissions</a></li><li><a href="#2-install-vpu-omxil-and-adjust-configuration" class="table-of-contents__link toc-highlight">2. Install <code>vpu-omxil</code> and Adjust Configuration</a></li><li><a href="#3-add-dmabuf-patch" class="table-of-contents__link toc-highlight">3. Add <code>dmabuf</code> Patch</a></li><li><a href="#4-initial-gstreamer-decoding-test" class="table-of-contents__link toc-highlight">4. Initial GStreamer Decoding Test</a></li></ul></li><li><a href="#b-choosing-the-right-gstreamer-video-sink" class="table-of-contents__link toc-highlight">B. Choosing the Right GStreamer <code>video-sink</code></a><ul><li><a href="#revyos-adaptation-notes" class="table-of-contents__link toc-highlight">RevyOS Adaptation Notes</a></li></ul></li><li><a href="#c-player-support" class="table-of-contents__link toc-highlight">C. Player Support</a><ul><li><a href="#revyos-adaptation-notes-1" class="table-of-contents__link toc-highlight">RevyOS Adaptation Notes</a></li></ul></li><li><a href="#summary-of-revyos-adaptation-work" class="table-of-contents__link toc-highlight">Summary of RevyOS Adaptation Work</a></li><li><a href="#resources-used" class="table-of-contents__link toc-highlight">Resources Used</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Installation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/revyos-docs-new/en/docs/Installation/intro">Installation Overview</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/revyos/revyos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 RevyOS. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>